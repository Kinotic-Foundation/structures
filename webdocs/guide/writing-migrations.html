<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Writing Migrations | Structures</title>
    <meta name="description" content="Learn how to write migrations in Structures to manage schema evolution and data transformations.">
    <meta name="generator" content="VitePress v1.6.3">
    <link rel="preload stylesheet" href="/webdocs/assets/style.DlODZvuE.css" as="style">
    <link rel="preload stylesheet" href="/webdocs/vp-icons.css" as="style">
    
    <script type="module" src="/webdocs/assets/app.Cw3cFpGt.js"></script>
    <link rel="preload" href="/webdocs/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/webdocs/assets/chunks/theme.AEpIecFB.js">
    <link rel="modulepreload" href="/webdocs/assets/chunks/framework.DrOG_Kkp.js">
    <link rel="modulepreload" href="/webdocs/assets/guide_writing-migrations.md.CSRwGrKZ.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-bcd43beb><!--[--><!--]--><!--[--><span tabindex="-1" data-v-c0133ace></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-c0133ace>Skip to content</a><!--]--><!----><header class="VPNav" data-v-bcd43beb data-v-dabd3259><div class="VPNavBar" data-v-dabd3259 data-v-b66eaa79><div class="wrapper" data-v-b66eaa79><div class="container" data-v-b66eaa79><div class="title" data-v-b66eaa79><div class="VPNavBarTitle has-sidebar" data-v-b66eaa79 data-v-f2b6cc46><a class="title" href="/webdocs/" data-v-f2b6cc46><!--[--><!--]--><!----><span data-v-f2b6cc46>Structures</span><!--[--><!--]--></a></div></div><div class="content" data-v-b66eaa79><div class="content-body" data-v-b66eaa79><!--[--><!--]--><div class="VPNavBarSearch search" data-v-b66eaa79><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-b66eaa79 data-v-758c4033><span id="main-nav-aria-label" class="visually-hidden" data-v-758c4033> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/webdocs/guide/overview.html" tabindex="0" data-v-758c4033 data-v-6b930ca0><!--[--><span data-v-6b930ca0>Guide</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/webdocs/reference/structures-server-config.html" tabindex="0" data-v-758c4033 data-v-6b930ca0><!--[--><span data-v-6b930ca0>Reference</span><!--]--></a><!--]--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="https://kinotic-foundation.github.io/structures/allure" target="_blank" rel="noreferrer" tabindex="0" data-v-758c4033 data-v-6b930ca0><!--[--><span data-v-6b930ca0>Test Status</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-b66eaa79 data-v-ef2ff9bb><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-ef2ff9bb data-v-5581fd1d data-v-0d7d18d6><span class="check" data-v-0d7d18d6><span class="icon" data-v-0d7d18d6><!--[--><span class="vpi-sun sun" data-v-5581fd1d></span><span class="vpi-moon moon" data-v-5581fd1d></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-b66eaa79 data-v-835946d8 data-v-8095a13e><!--[--><a class="VPSocialLink no-icon" href=" https://github.com/Kinotic-Foundation/structures" aria-label="github" target="_blank" rel="noopener" data-v-8095a13e data-v-c6e3fe79><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-b66eaa79 data-v-93988d26 data-v-5d1f801d><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-5d1f801d><span class="vpi-more-horizontal icon" data-v-5d1f801d></span></button><div class="menu" data-v-5d1f801d><div class="VPMenu" data-v-5d1f801d data-v-0ba825a4><!----><!--[--><!--[--><!----><div class="group" data-v-93988d26><div class="item appearance" data-v-93988d26><p class="label" data-v-93988d26>Appearance</p><div class="appearance-action" data-v-93988d26><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-93988d26 data-v-5581fd1d data-v-0d7d18d6><span class="check" data-v-0d7d18d6><span class="icon" data-v-0d7d18d6><!--[--><span class="vpi-sun sun" data-v-5581fd1d></span><span class="vpi-moon moon" data-v-5581fd1d></span><!--]--></span></span></button></div></div></div><div class="group" data-v-93988d26><div class="item social-links" data-v-93988d26><div class="VPSocialLinks social-links-list" data-v-93988d26 data-v-8095a13e><!--[--><a class="VPSocialLink no-icon" href=" https://github.com/Kinotic-Foundation/structures" aria-label="github" target="_blank" rel="noopener" data-v-8095a13e data-v-c6e3fe79><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-b66eaa79 data-v-63552372><span class="container" data-v-63552372><span class="top" data-v-63552372></span><span class="middle" data-v-63552372></span><span class="bottom" data-v-63552372></span></span></button></div></div></div></div><div class="divider" data-v-b66eaa79><div class="divider-line" data-v-b66eaa79></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-bcd43beb data-v-33cbe1b5><div class="container" data-v-33cbe1b5><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-33cbe1b5><span class="vpi-align-left menu-icon" data-v-33cbe1b5></span><span class="menu-text" data-v-33cbe1b5>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-33cbe1b5 data-v-d49b5a0e><button data-v-d49b5a0e>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-bcd43beb data-v-a1927c85><div class="curtain" data-v-a1927c85></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-a1927c85><span class="visually-hidden" id="sidebar-aria-label" data-v-a1927c85> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-41eb1830><section class="VPSidebarItem level-0 has-active" data-v-41eb1830 data-v-81f75864><div class="item" role="button" tabindex="0" data-v-81f75864><div class="indicator" data-v-81f75864></div><h2 class="text" data-v-81f75864>Introduction</h2><!----></div><div class="items" data-v-81f75864><!--[--><div class="VPSidebarItem level-1 is-link" data-v-81f75864 data-v-81f75864><div class="item" data-v-81f75864><div class="indicator" data-v-81f75864></div><a class="VPLink link link" href="/webdocs/guide/overview.html" data-v-81f75864><!--[--><p class="text" data-v-81f75864>What is Structures?</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-81f75864 data-v-81f75864><div class="item" data-v-81f75864><div class="indicator" data-v-81f75864></div><a class="VPLink link link" href="/webdocs/guide/getting-started.html" data-v-81f75864><!--[--><p class="text" data-v-81f75864>Getting Started</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-81f75864 data-v-81f75864><div class="item" data-v-81f75864><div class="indicator" data-v-81f75864></div><a class="VPLink link link" href="/webdocs/guide/writing-migrations.html" data-v-81f75864><!--[--><p class="text" data-v-81f75864>Writing Migrations</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-41eb1830><section class="VPSidebarItem level-0" data-v-41eb1830 data-v-81f75864><div class="item" role="button" tabindex="0" data-v-81f75864><div class="indicator" data-v-81f75864></div><h2 class="text" data-v-81f75864>Details</h2><!----></div><div class="items" data-v-81f75864><!--[--><section class="VPSidebarItem level-1 is-link" data-v-81f75864 data-v-81f75864><div class="item" tabindex="0" data-v-81f75864><div class="indicator" data-v-81f75864></div><a class="VPLink link link" href="/webdocs/guide/graphos/overview.html" data-v-81f75864><!--[--><h3 class="text" data-v-81f75864>Apollo @policy Support</h3><!--]--></a><!----></div><div class="items" data-v-81f75864><!--[--><div class="VPSidebarItem level-2 is-link" data-v-81f75864 data-v-81f75864><div class="item" data-v-81f75864><div class="indicator" data-v-81f75864></div><a class="VPLink link link" href="/webdocs/guide/graphos/policy-decorators.html" data-v-81f75864><!--[--><p class="text" data-v-81f75864>Policy Decorators</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-81f75864 data-v-81f75864><div class="item" data-v-81f75864><div class="indicator" data-v-81f75864></div><a class="VPLink link link" href="/webdocs/guide/graphos/policy-evaluation-flow.html" data-v-81f75864><!--[--><p class="text" data-v-81f75864>Policy Evaluation Flow</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-bcd43beb data-v-b91548c3><div class="VPDoc has-sidebar has-aside" data-v-b91548c3 data-v-ebcb5658><!--[--><!--]--><div class="container" data-v-ebcb5658><div class="aside" data-v-ebcb5658><div class="aside-curtain" data-v-ebcb5658></div><div class="aside-container" data-v-ebcb5658><div class="aside-content" data-v-ebcb5658><div class="VPDocAside" data-v-ebcb5658 data-v-0f29a4cc><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-0f29a4cc data-v-4f7ebbbc><div class="content" data-v-4f7ebbbc><div class="outline-marker" data-v-4f7ebbbc></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-4f7ebbbc>On this page</div><ul class="VPDocOutlineItem root" data-v-4f7ebbbc data-v-6c94c164><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-0f29a4cc></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-ebcb5658><div class="content-container" data-v-ebcb5658><!--[--><!--]--><main class="main" data-v-ebcb5658><div style="position:relative;" class="vp-doc _webdocs_guide_writing-migrations" data-v-ebcb5658><div><h1 id="writing-migrations" tabindex="-1">Writing Migrations <a class="header-anchor" href="#writing-migrations" aria-label="Permalink to &quot;Writing Migrations&quot;">​</a></h1><p>Migrations in Structures allow you to define and apply changes to your Elasticsearch indices in a controlled, versioned manner. Each migration is a SQL-like script identified by a unique version in its filename, ensuring idempotency and traceability. This guide explains how to write migration scripts and details the supported statements. If you&#39;re new to Structures, start with the <a href="/webdocs/guide/overview.html">What is Structures?</a> guide.</p><h2 id="migration-script-structure" tabindex="-1">Migration Script Structure <a class="header-anchor" href="#migration-script-structure" aria-label="Permalink to &quot;Migration Script Structure&quot;">​</a></h2><p>Migration scripts are written in a SQL-like syntax and consist of one or more statements. The version is determined by the filename in the format <code>V&lt;number&gt;__&lt;description&gt;.sql</code>.</p><h3 id="filename-format" tabindex="-1">Filename Format <a class="header-anchor" href="#filename-format" aria-label="Permalink to &quot;Filename Format&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>V&lt;number&gt;__&lt;description&gt;.sql</span></span></code></pre></div><ul><li><code>&lt;number&gt;</code>: A sequential number (e.g., <code>1</code>, <code>2</code>, <code>3</code>) to track applied migrations.</li><li><code>&lt;description&gt;</code>: A brief description of the migration&#39;s purpose.</li></ul><h3 id="example" tabindex="-1">Example <a class="header-anchor" href="#example" aria-label="Permalink to &quot;Example&quot;">​</a></h3><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- Initial schema setup</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> users</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TEXT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, age </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INTEGER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- Add a field and populate data</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ALTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> users </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ADD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COLUMN active </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">BOOLEAN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">UPDATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> users </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> active </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> true </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> age </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 18</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p>The above content would be saved in a file named <code>V1__create_users_table.sql</code>.</p><h2 id="how-migrations-work" tabindex="-1">How Migrations Work <a class="header-anchor" href="#how-migrations-work" aria-label="Permalink to &quot;How Migrations Work&quot;">​</a></h2><ol><li><strong>Discovery</strong>: Migrations are discovered from files (or other sources) and represented as <code>Migration</code> objects. The version is extracted from the filename (e.g., <code>V1__desc.sql</code> → version 1) by the migration abstraction, not from the file content.</li><li><strong>Parsing</strong>: The <code>MigrationParser</code> parses the script only if the migration has not already been applied, producing a <code>MigrationContent</code> object containing the list of statements.</li><li><strong>Execution</strong>: The <code>MigrationExecutor</code> processes each <code>Migration</code>: <ul><li>If not applied, executes all statements from the <code>MigrationContent</code> and records the version.</li><li>If already applied, skips the migration.</li></ul></li><li><strong>Idempotency</strong>: Ensures changes are applied only once.</li></ol><blockquote><p><strong>Note:</strong> The migration system is efficient and scalable: only unapplied migrations are parsed and loaded into memory, and versioning is handled by the migration abstraction (not the script content).</p></blockquote><h2 id="supported-statements" tabindex="-1">Supported Statements <a class="header-anchor" href="#supported-statements" aria-label="Permalink to &quot;Supported Statements&quot;">​</a></h2><p>Below are the SQL-like statements supported in migration scripts, with examples.</p><h3 id="_1-create-table" tabindex="-1">1. CREATE TABLE <a class="header-anchor" href="#_1-create-table" aria-label="Permalink to &quot;1. CREATE TABLE&quot;">​</a></h3><p>Creates a new Elasticsearch index with specified column mappings.</p><ul><li><strong>Syntax</strong>: <code>CREATE TABLE &lt;index_name&gt; (&lt;column_name&gt; &lt;type&gt; [, &lt;column_name&gt; &lt;type&gt;]*) ;</code></li><li><strong>Types</strong>: See the Supported Types table in the <a href="/webdocs/reference/migrations-sql-grammar.html#supported-types">Migrations SQL Grammar Reference</a> for a full list and backend mappings.</li><li><strong>Example</strong>:</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> users</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TEXT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, age </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INTEGER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, active </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">BOOLEAN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h3 id="_2-create-component-template" tabindex="-1">2. CREATE COMPONENT TEMPLATE <a class="header-anchor" href="#_2-create-component-template" aria-label="Permalink to &quot;2. CREATE COMPONENT TEMPLATE&quot;">​</a></h3><p>Defines a reusable component template with settings and mappings.</p><ul><li><strong>Syntax</strong>: <code>CREATE COMPONENT TEMPLATE &lt;template_name&gt; (&lt;definition&gt; [, &lt;definition&gt;]*) ;</code></li><li><strong>Definitions</strong>: <code>NUMBER_OF_SHARDS = &lt;integer&gt;</code>, <code>NUMBER_OF_REPLICAS = &lt;integer&gt;</code>, <code>&lt;column_name&gt; &lt;type&gt;</code></li><li><strong>Example</strong>:</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COMPONENT TEMPLATE user_settings (NUMBER_OF_SHARDS </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, NUMBER_OF_REPLICAS </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> KEYWORD);</span></span></code></pre></div><h3 id="_3-create-index-template" tabindex="-1">3. CREATE INDEX TEMPLATE <a class="header-anchor" href="#_3-create-index-template" aria-label="Permalink to &quot;3. CREATE INDEX TEMPLATE&quot;">​</a></h3><p>Creates an index template with a pattern, component templates, and optional settings/mappings.</p><ul><li><strong>Syntax</strong>: <code>CREATE INDEX TEMPLATE &lt;template_name&gt; FOR &#39;&lt;pattern&gt;&#39; USING &#39;&lt;component_template&gt;&#39; [WITH (&lt;definition&gt; [, &lt;definition&gt;]*) ] ;</code></li><li><strong>Example</strong>:</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> INDEX</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TEMPLATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user_idx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FOR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;users-*&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> USING</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;user_settings&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> WITH</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (age </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INTEGER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, active </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">BOOLEAN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h3 id="_4-alter-table" tabindex="-1">4. ALTER TABLE <a class="header-anchor" href="#_4-alter-table" aria-label="Permalink to &quot;4. ALTER TABLE&quot;">​</a></h3><p>Adds a new field to an existing Elasticsearch index.</p><ul><li><strong>Syntax</strong>: <code>ALTER TABLE &lt;index_name&gt; ADD COLUMN &lt;column_name&gt; &lt;type&gt; ;</code></li><li><strong>Example</strong>:</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ALTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> users </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ADD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COLUMN active </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">BOOLEAN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h3 id="_5-reindex" tabindex="-1">5. REINDEX <a class="header-anchor" href="#_5-reindex" aria-label="Permalink to &quot;5. REINDEX&quot;">​</a></h3><p>Reindexes data from one index to another with optional settings.</p><ul><li><strong>Syntax</strong>: <code>REINDEX &lt;source_index&gt; INTO &lt;dest_index&gt; [WITH (&lt;option&gt; [, &lt;option&gt;]*) ] ;</code></li><li><strong>Options</strong>: <ul><li><code>CONFLICTS = (ABORT | PROCEED)</code></li><li><code>MAX_DOCS = &lt;integer&gt;</code></li><li><code>SLICES = (AUTO | &lt;integer&gt;)</code></li><li><code>SIZE = &lt;integer&gt;</code></li><li><code>SOURCE_FIELDS = &#39;&lt;fields&gt;&#39;</code></li><li><code>QUERY = &#39;&lt;lucene_query&gt;&#39;</code></li><li><code>SCRIPT = &#39;&lt;script&gt;&#39;</code></li><li><code>WAIT = (TRUE | FALSE)</code> (if <code>WAIT = TRUE</code>, the migration will poll for completion and only continue when reindexing is done; otherwise, it returns immediately with the task ID)</li><li><code>SKIP_IF_NO_SOURCE = (TRUE | FALSE)</code> (if <code>TRUE</code>, the reindex will be skipped if the source index does not exist; default is <code>FALSE</code>)</li></ul></li><li><strong>Example</strong>:</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">REINDEX users </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INTO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> users_new </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WITH</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (CONFLICTS </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PROCEED, MAX_DOCS </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, SLICES </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> AUTO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, QUERY </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;active:true&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, WAIT </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TRUE);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">REINDEX users </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INTO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> users_new </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WITH</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (SKIP_IF_NO_SOURCE </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TRUE);</span></span></code></pre></div><blockquote><p><strong>Note:</strong> REINDEX is always executed asynchronously at the Elasticsearch level. If <code>WAIT = TRUE</code>, Structures will poll for completion before proceeding to the next statement. If <code>WAIT = FALSE</code> or omitted, the migration continues immediately and returns the Elasticsearch task ID. <strong>Note:</strong> If <code>SKIP_IF_NO_SOURCE = TRUE</code>, the reindex operation will be skipped (no error) if the source index does not exist. This is useful for idempotent migrations or when the source may be missing in some environments.</p></blockquote><h3 id="_6-insert" tabindex="-1">6. INSERT <a class="header-anchor" href="#_6-insert" aria-label="Permalink to &quot;6. INSERT&quot;">​</a></h3><p>Inserts new documents into an index with specified field values.</p><ul><li><strong>Syntax</strong>: <code>INSERT INTO &lt;index_name&gt; [(&lt;column_name&gt; [, &lt;column_name&gt;]*)] VALUES (&lt;expression&gt; [, &lt;expression&gt;]*) [WITH REFRESH] ;</code></li><li><strong>Options</strong>: <ul><li><code>WITH REFRESH</code> (immediately refreshes the index after insert)</li></ul></li><li><strong>Expressions</strong>: Literals (<code>&#39;value&#39;</code>, <code>123</code>, <code>true</code>), parameters (<code>?</code>), field references (<code>field_name</code>)</li><li><strong>Example</strong>:</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- Insert a single document with column names</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INSERT INTO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> users (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, age, active) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">VALUES</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;John&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, true);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- Insert without specifying columns (all fields must be provided in order)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INSERT INTO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> users </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">VALUES</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Jane&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">25</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, false);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- Insert and refresh the index</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INSERT INTO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> users (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, age) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">VALUES</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Alice&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">22</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WITH</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> REFRESH;</span></span></code></pre></div><h3 id="_7-update" tabindex="-1">7. UPDATE <a class="header-anchor" href="#_7-update" aria-label="Permalink to &quot;7. UPDATE&quot;">​</a></h3><p>Updates documents in an index based on a WHERE clause and SET assignments.</p><ul><li><strong>Syntax</strong>: <code>UPDATE &lt;index_name&gt; SET &lt;field&gt; = &lt;expression&gt; [, &lt;field&gt; = &lt;expression&gt;]* WHERE &lt;where_clause&gt; [WITH REFRESH] ;</code></li><li><strong>Options</strong>: <ul><li><code>WITH REFRESH</code> (immediately refreshes the index after update)</li></ul></li><li><strong>Expressions</strong>: Literals (<code>&#39;value&#39;</code>, <code>123</code>, <code>true</code>), parameters (<code>?</code>), binary expressions (<code>field + 1</code>)</li><li><strong>Where Clause</strong>: Conditions (<code>field &lt; value</code>), <code>AND</code>, <code>OR</code>, parentheses</li><li><strong>Example</strong>:</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">UPDATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> users </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SET</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> status</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;active&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, age </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> age </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> WHERE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;John&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> AND</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> age </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 30</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> WITH</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> REFRESH;</span></span></code></pre></div><h3 id="_8-delete" tabindex="-1">8. DELETE <a class="header-anchor" href="#_8-delete" aria-label="Permalink to &quot;8. DELETE&quot;">​</a></h3><p>Deletes documents from an index based on a WHERE clause.</p><ul><li><strong>Syntax</strong>: <code>DELETE FROM &lt;index_name&gt; WHERE &lt;where_clause&gt; [WITH REFRESH] ;</code></li><li><strong>Options</strong>: <ul><li><code>WITH REFRESH</code> (immediately refreshes the index after delete)</li></ul></li><li><strong>Example</strong>:</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DELETE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> users </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> active </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> false </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WITH</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> REFRESH;</span></span></code></pre></div><h2 id="further-reference" tabindex="-1">Further Reference <a class="header-anchor" href="#further-reference" aria-label="Permalink to &quot;Further Reference&quot;">​</a></h2><p>For a comprehensive, technical reference of all supported statements, options, and syntax, see the <a href="/webdocs/reference/migrations-sql-grammar.html">Migrations SQL Grammar Reference</a>.</p></div></div></main><footer class="VPDocFooter" data-v-ebcb5658 data-v-7708fbd0><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-7708fbd0><span class="visually-hidden" id="doc-footer-aria-label" data-v-7708fbd0>Pager</span><div class="pager" data-v-7708fbd0><a class="VPLink link pager-link prev" href="/webdocs/guide/getting-started.html" data-v-7708fbd0><!--[--><span class="desc" data-v-7708fbd0>Previous page</span><span class="title" data-v-7708fbd0>Getting Started</span><!--]--></a></div><div class="pager" data-v-7708fbd0><a class="VPLink link pager-link next" href="/webdocs/guide/graphos/overview.html" data-v-7708fbd0><!--[--><span class="desc" data-v-7708fbd0>Next page</span><span class="title" data-v-7708fbd0>Apollo @policy Support</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-bcd43beb data-v-7cc715de><div class="container" data-v-7cc715de><p class="message" data-v-7cc715de>Released under the Apache License.</p><p class="copyright" data-v-7cc715de>Copyright © 2018-present Kinotic Foundation</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"api-examples.md\":\"LodZowMS\",\"guide_getting-started.md\":\"HfNxzD4d\",\"guide_graphos_entity-service-decorators.md\":\"0dGF5YLL\",\"guide_graphos_overview.md\":\"DJym4MKb\",\"guide_graphos_policy-decorators.md\":\"Dytuo_MP\",\"guide_graphos_policy-evaluation-flow.md\":\"DruqREHW\",\"guide_multi-tenant-access.md\":\"D8_6W7e_\",\"guide_overview.md\":\"BwSgfuIF\",\"guide_writing-migrations.md\":\"CSRwGrKZ\",\"index.md\":\"Ouv2yxLb\",\"markdown-examples.md\":\"B2-q9S2Z\",\"reference_decorators.md\":\"ChlezBO7\",\"reference_graphos_policy-authorization-request.md\":\"B44ofJ8w\",\"reference_graphos_policy-authorization-service.md\":\"DCTqu_G0\",\"reference_graphos_policy-authorizer.md\":\"CdaAKXxC\",\"reference_graphos_security-context.md\":\"Fq3h3xcd\",\"reference_javadoc.md\":\"C8W1b5jw\",\"reference_migrations-sql-grammar.md\":\"DZardbya\",\"reference_structures-server-config.md\":\"-jitcizV\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Structures\",\"description\":\"Structures is an open-source framework for data storage and retrieval, supporting schema evolution, data management, and providing a user-friendly GUI.\",\"base\":\"/webdocs/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"Guide\",\"link\":\"/guide/overview\",\"activeMatch\":\"/guide/\"},{\"text\":\"Reference\",\"link\":\"/reference/structures-server-config\",\"activeMatch\":\"/reference/\"},{\"text\":\"Test Status\",\"link\":\"https://kinotic-foundation.github.io/structures/allure\"}],\"sidebar\":{\"/guide/\":[{\"text\":\"Introduction\",\"items\":[{\"text\":\"What is Structures?\",\"link\":\"/guide/overview\"},{\"text\":\"Getting Started\",\"link\":\"/guide/getting-started\"},{\"text\":\"Writing Migrations\",\"link\":\"/guide/writing-migrations\"}]},{\"text\":\"Details\",\"items\":[{\"text\":\"Apollo @policy Support\",\"link\":\"/guide/graphos/overview\",\"items\":[{\"text\":\"Policy Decorators\",\"link\":\"/guide/graphos/policy-decorators\"},{\"text\":\"Policy Evaluation Flow\",\"link\":\"/guide/graphos/policy-evaluation-flow\"}]}]}],\"/reference/\":[{\"text\":\"Reference\",\"items\":[{\"text\":\"Structures Server Config\",\"link\":\"/reference/structures-server-config\"},{\"text\":\"Migrations SQL Grammar\",\"link\":\"/reference/migrations-sql-grammar\"}]},{\"text\":\"API\",\"items\":[{\"text\":\"Decorators\",\"link\":\"/reference/decorators\"},{\"text\":\"PolicyAuthorizationService\",\"link\":\"/reference/graphos/policy-authorization-service\"},{\"text\":\"PolicyAuthorizer\",\"link\":\"/reference/graphos/policy-authorizer\"},{\"text\":\"PolicyAuthorizationRequest\",\"link\":\"/reference/graphos/policy-authorization-request\"}]}]},\"socialLinks\":[{\"icon\":\"github\",\"link\":\" https://github.com/Kinotic-Foundation/structures\"}],\"footer\":{\"message\":\"Released under the Apache License.\",\"copyright\":\"Copyright © 2018-present Kinotic Foundation\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>